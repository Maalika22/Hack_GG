{% extends "base_admin.html" %}

{% block page_title %}Equipment Management{% endblock %}
{% block page_subtitle %}Manage all company equipment and assets{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <a href="{{ url_for('equipment_new') }}" class="btn btn-admin-primary">
            <i class="bi bi-plus-circle"></i> New
        </a>
    </div>
    <div class="input-group" style="max-width: 300px;">
        <input type="text" class="form-control" placeholder="Q Search..." id="searchInput">
        <button class="btn btn-outline-secondary" type="button">
            <i class="bi bi-search"></i>
        </button>
    </div>
</div>

<div class="admin-card">
    <div class="admin-card-header">
        <h5 class="mb-0">Equipment</h5>
    </div>
    <div class="admin-card-body">
        {% if equipment %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Equipment Name</th>
                        <th>Employee</th>
                        <th>Department</th>
                        <th>Serial Number</th>
                        <th>Technician</th>
                        <th>Equipment Category</th>
                        <th>Company</th>
                        <th>Health</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for eq in equipment %}
                    <tr>
                        <td>
                            <a href="{{ url_for('equipment_detail', id=eq.id) }}" class="text-decoration-none fw-semibold">
                                {{ eq.name }}
                            </a>
                        </td>
                        <td>{{ eq.owner.full_name if eq.owner else '-' }}</td>
                        <td>{{ eq.department.name if eq.department else '-' }}</td>
                        <td>{{ eq.serial_number or '-' }}</td>
                        <td>{{ eq.default_technician.full_name if eq.default_technician else '-' }}</td>
                        <td>{{ eq.category.name if eq.category else '-' }}</td>
                        <td>{{ eq.company.name if eq.company else '-' }}</td>
                        <td>
                            <div class="d-flex align-items-center">
                                <div class="progress" style="width: 60px; height: 8px; margin-right: 8px;">
                                    <div class="progress-bar bg-{{ 'danger' if eq.health_percentage < 30 else 'warning' if eq.health_percentage < 60 else 'success' }}" 
                                         role="progressbar" 
                                         style="width: {{ eq.health_percentage }}%"></div>
                                </div>
                                <span class="small">{{ eq.health_percentage }}%</span>
                            </div>
                        </td>
                        <td>
                            <div class="btn-group" role="group">
                                <a href="{{ url_for('equipment_detail', id=eq.id) }}" class="btn btn-sm btn-outline-primary">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <a href="{{ url_for('equipment_edit', id=eq.id) }}" class="btn btn-sm btn-primary">
                                    <i class="bi bi-pencil"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5 text-muted">
            <i class="bi bi-gear" style="font-size: 3rem;"></i>
            <p class="mt-3">No equipment found. Create your first equipment!</p>
            <a href="{{ url_for('equipment_new') }}" class="btn btn-admin-primary mt-2">
                <i class="bi bi-plus-circle"></i> Create Equipment
            </a>
        </div>
        {% endif %}
    </div>
</div>

<script>
// Simple search functionality
document.getElementById('searchInput').addEventListener('keyup', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const rows = document.querySelectorAll('tbody tr');
    
    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
    });
});
</script>
{% endblock %}


